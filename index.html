<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>老袁编剧卡片系统</title>
    <link rel="stylesheet" href="style.css">
    <!-- 添加拖拽库 -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>
    <header>
        <h1>老袁编剧卡片系统（ipad优化版）<span class="version-info">v0.8.1</span></h1>
        <div class="project-controls">
            <select id="script-type" class="script-type-selector">
                <option value="movie">电影</option>
                <option value="tv-hour" selected>一小时剧集</option>
                <option value="tv-half">半小时喜剧</option>
            </select>
            <input type="text" id="project-title" placeholder="剧本名称">
            <div class="header-buttons">
                <button id="save-project" data-tooltip="将项目以JSON文件保存，用于备份、分享">保存项目</button>
                <button id="load-project" data-tooltip="读取浏览器缓存的自动保存版本">加载项目</button>
                <button id="import-project" data-tooltip="打开本地存储的JSON文件">导入项目</button>
                <button id="show-stats" data-tooltip="展示剧本的统计数据和分析">显示统计</button>
                <button id="export-outline" data-tooltip="导出为可读的文本大纲格式">导出大纲</button>
                <button id="feedback-btn" class="feedback-btn" data-tooltip="提交问题报告或功能建议">反馈</button>
            </div>
        </div>
    </header>
    
    <div class="view-controls">
        <button id="view-all" class="view-btn active">全部</button>
        <button id="view-act-1" class="view-btn">第一幕</button>
        <button id="view-act-2" class="view-btn">第二幕</button>
        <button id="view-act-3" class="view-btn">第三幕</button>
        <button id="view-act-4" class="view-btn">第四幕</button>
    </div>
    
    <div class="board-container">
        <div class="board" id="script-board">
            <!-- 动态生成的幕结构将在这里显示 -->
        </div>
    </div>
    
    <!-- 悬浮添加按钮 -->
    <div class="floating-add-button" id="quick-add-btn">+</div>
    
    <!-- 新增: 悬浮功能菜单 -->
    <div class="floating-menu">
    <div class="floating-menu-item" id="trash-bin-btn">
        <i class="menu-icon">🗑️</i>
        <span class="menu-text">垃圾桶</span>
    </div>
    <div class="floating-menu-item" id="inspiration-btn">
        <i class="menu-icon">💡</i>
        <span class="menu-text">灵感箱</span></div>
    </div>

<!-- 新增: 拖拽删除用的垃圾桶 -->
<div id="drag-trash-bin" class="drag-trash-bin hidden">
    <div class="trash-icon">🗑️</div>
    <div class="trash-text">拖拽至此删除</div>
</div>


    <!-- 快速添加卡片菜单 -->
    <div class="quick-add-menu" id="quick-add-menu">
        <div class="quick-add-header">
            <h3>快速添加卡片</h3>
            <button class="close-quick-add">&times;</button>
        </div>
        <div class="quick-add-content">
            <div class="quick-add-section">
                <label>添加到：</label>
                <div class="act-beat-selector">
                    <!-- 动态生成的幕和节拍选择器 -->
                </div>
            </div>
            
            <div class="quick-add-section">
                <label>状态：</label>
                <div class="status-options">
                    <div class="status-option" data-status="confirmed">
                        <span class="status-emoji">✅</span> 确认
                    </div>
                    <div class="status-option" data-status="pending">
                        <span class="status-emoji">⏳</span> 保留
                    </div>
                    <div class="status-option" data-status="question">
                        <span class="status-emoji">❓</span> 存疑
                    </div>
                </div>
                <input type="hidden" id="quick-add-status" value="confirmed">
            </div>
            
            <div class="quick-add-section">
                <label>场景位置：</label>
                <div class="location-input">
                    <select id="quick-add-location-type">
                        <option value="INT">INT.</option>
                        <option value="EXT">EXT.</option>
                    </select>
                    <input type="text" id="quick-add-location" placeholder="位置描述">
                </div>
            </div>
            
            <div class="quick-add-section">
                <label>场景描述：</label>
                <textarea id="quick-add-description" placeholder="简短描述场景..."></textarea>
            </div>
            
            <div class="quick-add-actions">
                <button id="quick-add-save">添加卡片</button>
                <button id="quick-add-save-and-new">添加并创建新卡片</button>
            </div>
        </div>
    </div>
    
    <!-- 卡片编辑模态框 -->
    <div id="card-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>编辑卡片</h2>
            <form id="card-form">
                <input type="hidden" id="card-id">
                <input type="hidden" id="card-act">
                <input type="hidden" id="card-beat">
                
                <div class="form-group">
                    <label>卡片标记:</label>
                    <select id="card-status">
                        <option value="confirmed">确认</option>
                        <option value="pending">保留</option>
                        <option value="question">存疑</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>场景位置:</label>
                    <select id="scene-location-type">
                        <option value="INT">INT.</option>
                        <option value="EXT">EXT.</option>
                    </select>
                    <input type="text" id="scene-location" placeholder="位置描述">
                </div>
                
                <div class="form-group">
                    <label>场景描述:</label>
                    <textarea id="scene-description" placeholder="简短描述场景发生的事情，不要超过2-3句话"></textarea>
                </div>
                
                <div class="form-group">
                    <label>冲突:</label>
                    <div class="conflict-inputs">
                        <input type="text" id="protagonist" placeholder="主人公">
                        <input type="text" id="goal" placeholder="目标">
                        <input type="text" id="obstacle" placeholder="障碍">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>情感变化:</label>
                    <div class="emotional-change-inputs">
                        <select id="emotional-change-type">
                            <option value="positive">正向 (+)</option>
                            <option value="negative">负向 (-)</option>
                        </select>
                        <input type="text" id="emotional-change-content" placeholder="描述情感变化的具体内容">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" id="save-card">保存</button>
                    <button type="button" id="duplicate-card">复制</button>
                    <button type="button" id="delete-card">删除</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 文件名输入模态框 -->
    <div id="filename-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>保存项目</h2>
            <form id="filename-form">
                <div class="form-group">
                    <label>文件名:</label>
                    <input type="text" id="filename-input" placeholder="输入文件名">
                </div>
                <div class="form-actions">
                    <button type="submit">保存</button>
                    <button type="button" class="close-modal">取消</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 文件上传模态框 -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>导入项目</h2>
            <form id="import-form">
                <div class="form-group">
                    <label>选择项目文件:</label>
                    <input type="file" id="import-file" accept=".json">
                </div>
                <div class="form-actions">
                    <button type="submit">导入</button>
                    <button type="button" class="close-modal">取消</button>
                </div>
            </form>
        </div>
    </div>

<!-- 项目加载模态框 -->
<div id="load-project-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>加载项目</h2>
        <div class="project-list-container">
            <div class="project-list-header">
                <div class="project-name-header">项目名称</div>
                <div class="project-date-header">最后保存时间</div>
                <div class="project-actions-header">操作</div>
            </div>
            <div id="project-list" class="project-list">
                <!-- 项目列表将在这里动态生成 -->
                <div class="no-projects">没有找到已保存的项目</div>
            </div>
        </div>
        <div class="form-actions">
            <button type="button" id="refresh-project-list">刷新列表</button>
            <button type="button" class="close-modal-btn">取消</button>
        </div>
    </div>
</div>
    
    <!-- 统计分析模态框 -->
    <div id="stats-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>剧本分析</h2>
            <div id="stats-content"></div>
        </div>
    </div>
    
    <!-- 反馈模态框 -->
    <div id="feedback-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>反馈与建议</h2>
            <form id="feedback-form">
                <div class="form-group">
                    <label>您的电子邮箱 (选填):</label>
                    <input type="email" id="feedback-email" placeholder="email@example.com">
                </div>
                <div class="form-group">
                    <label>反馈内容:</label>
                    <textarea id="feedback-content" placeholder="请输入您的反馈或建议..." required></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit">提交反馈</button>
                    <button type="button" class="close-modal">取消</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 自动保存提示 -->
    <div id="autosave-indicator" class="autosave-indicator">已自动保存</div>
    
    <!-- 提示消息 -->
    <div id="toast-container"></div>
    
    <script src="script.js"></script>
</body>
</html>
